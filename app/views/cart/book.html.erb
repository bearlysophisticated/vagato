<h2>Foglalás véglegesítés</h2>

<div class="well well-sm">
  <div class="row">
    <%= simple_form_for @booking, url: {controller: 'cart', action: 'add'} do |c| %>
        <div class='col-md-5'>
          <div class="form-group">
            <div class='input-group'>
              <%= c.text_field :start_date, class: 'form-control', disabled: true %>
              <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <div class='input-group'>
              <%= c.text_field :num_of_nights, class: 'form-control', disabled: true %>
              <span class="input-group-addon"><i class="fa fa-moon-o"></i></span>
            </div>
          </div>
        </div>
        <div class='col-md-5'>
          <div class="form-group">
            <div class='input-group'>
              <%= c.text_field :end_date, class: 'form-control', disabled: true %>
              <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
            </div>
          </div>
        </div>
    <% end %>
  </div>
</div>

<%= form_tag do |b| %>

    <% @booking.rooms.each do |r| %>
        <div class="separator"></div>

        <div class="row">
          <div class="col-md-3">
            <%= render 'rooms/thumbnail', :room => r %>
          </div>
          <div class="col-md-9">
            <div class="well">
              <% i = 0 %>
              <% while i < r.capacity do %>
                  <div class="form-group">
                      <%= label_tag 'Név' %>
                      <%= text_field_tag "name#{r.id}#{i+1}", r==@booking.rooms.first && i==0 ? current_user.role.name : nil, required: true, class: 'form-control' %>
                  </div>
                  <div class="form-group">
                      <%= label_tag 'Született' %>
                    <div class="input-group">
                      <%= text_field_tag "birth#{r.id}#{i+1}", r==@booking.rooms.first && i==0  ? current_user.role.day_of_birth.to_s.gsub!('-','.') : nil, required: true, class: 'form-control' %>
                      <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                    </div>
                  </div>
                  <% i += 1 %>
                  <% if i < r.capacity %>
                    <div class="separator"></div>
                  <% end %>
              <% end %>
            </div>
          </div>
        </div>

    <% end %>

    <div class="row">
      <div class="col-md-6">
        <%= link_to 'Mégse', '/cart', class: 'btn btn-danger left' %>
      </div>
      <div class="col-md-6">
        <%= hidden_field_tag :booking_id, @booking.id %>
        <%= submit_tag 'Foglalás véglegesítése', class: 'btn btn-success right' %>
      </div>
    </div>

    <script type="application/javascript">
        var setupBirthDatePickers = function() {
        <% @booking.rooms.each do |r| %>
            <% i = 0 %>
            <% while i < r.capacity do %>
                $('#birth<%= r.id %><%= i+1 %>').datetimepicker({
                    locale: "hu",
                    format: "YYYY.MM.DD"
                });
                $('#birth<%= r.id %><%= i+1 %>').data("DateTimePicker").setMaxDate(new Date());
                <% i += 1 %>
            <% end %>
        <% end %>
        };

        var doc_ready = function() {
            setupBirthDatePickers();
        };

        $(document).ready(doc_ready);
        $(document).on('page:load', doc_ready);
    </script>

<% end %>